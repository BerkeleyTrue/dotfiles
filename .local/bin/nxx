#!/bin/bash

set -e

commndName=$(basename $0)
flake_uri=$HOME/.config/nixpkgs

username=$(whoami)

build() {
  nix build --no-link  $flake_uri#homeConfigurations.$username.activationPackage
  "$(nix path-info $flake_uri#homeConfigurations.$username.activationPackage)"/activate
}

switch() {
  home-manager switch --flake "$flake_uri#$username"
}

case $1 in
  build)
    build
    ;;
  switch)
    switch
    ;;
  *)
    echo "Usage: $commndName {build|switch}"
    exit 1
esac
