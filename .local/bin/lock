#!/bin/bash

{
	# exits non-zero if nothing is playing..
	playerctl pause &>/dev/null
	makoctl set-paused true
} &

# xmonad screencorner: move mouse out of corner to prevent retrigger on unlock
# TODO: needed for wayland/niri?
# xdotool mousemove_relative -- -10 -10
# wait for mouse to move or until_nonidle won't work
sleep 0.1

echo "Locking..."

# uses xset timeout to lock after x seconds of inactivity
# and dims the screen in the mean time
# after which xsecurelock is called
# when xsecurelock exits mako is used to notify the user
# TODO: hyprlock
/usr/lib/xsecurelock/until_nonidle /usr/lib/xsecurelock/dimmer ||
	(/usr/bin/xsecurelock && makoify -a "Hephaestus" -u low -i distributor-logo-nixos  "Welcome Back!" )

echo "Unlocking..."

makoctl set-paused false
