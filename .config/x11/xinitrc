#!/bin/sh

sysresources=/etc/X11/xinit/.Xresources
sysmodmap=/etc/X11/xinit/.Xmodmap

# Load system defaults
if [ -f $sysresources ]; then
    xrdb -merge $sysresources
fi

if [ -f $sysmodmap ]; then
    xmodmap $sysmodmap
fi

# Source programs in xinitrc.d (compatibility)
if [ -d /etc/X11/xinit/xinitrc.d ]; then
    for f in /etc/X11/xinit/xinitrc.d/?*.sh; do
        [ -x "$f" ] && . "$f"
    done
    unset f
fi

# the rest is managed by systemd - just wait for the session to end
# this process needs to stay alive to keep x running
# check to make make sure x11 is still running and x11-session.target is active
# once this script exits, X will stop
while pgrep -x Xorg >/dev/null && systemctl --user is-active x11-session.target >/dev/null 2>&1; do
    sleep 1
done

echo "xinitrc-systemd: X11 session ended"
